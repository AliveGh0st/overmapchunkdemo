# OvermapChunkDemo - 地图区块生成系统

基于Godot 4.x的程序化地图生成演示项目，实现了类似《大灾变：暗黑时代》(Cataclysm: Dark Days Ahead)的世界地图生成系统。

## 核心特性

### 地图生成系统
- **程序化地图生成**: 支持河流、湖泊、森林、沼泽、城市等多种地形
- **无限世界**: 基于区块的动态加载系统，支持无限大的世界
- **智能区块管理**: 当玩家接近边界时自动生成新区块
- **地形连续性**: 使用全局噪声确保相邻区块间地形无缝连接

### 地形类型
- **陆地**: 基础地形
- **河流**: 动态河流生成，支持湖泊连接
- **湖泊**: 表面和岸边区分，支持深度系统
- **森林**: 普通森林和茂密森林，支持方向性生成
- **沼泽**: 河流洪泛平原沼泽生成
- **道路**: 城市间道路连接系统
- **城市**: 城市化区域，包含建筑物生成

### 技术架构
- **统一配置管理**: 使用AutoLoad单例模式管理所有配置
- **模块化设计**: 分离渲染、玩家控制、UI等模块
- **性能优化**: 区块生成冷却、搜索半径优化等
- **调试支持**: 完整的运行时配置和调试信息

## 文件结构

```
├── config_manager.gd      # 统一配置管理器(AutoLoad)
├── overmap_renderer.gd    # 地图渲染和区块管理
├── overmap_player.gd      # 玩家控制器
├── overmap_ui.gd          # 用户界面和调试信息
├── overmap_system.tscn    # 主场景
└── project.godot          # 项目配置
```

## 配置系统

项目使用统一的配置管理器，包含以下配置类别：

### 渲染配置 (RenderConfig)
- `TILE_SIZE`: 16px - 每个瓦片的像素大小
- `CHUNK_SIZE`: 180 - 区块大小(格子数)
- `BORDER_THRESHOLD`: 11 - 触发新区块生成的边界阈值

### 地形配置 (TerrainConfig)
- 地形类型定义(陆地、河流、湖泊等)
- 地形到瓦片ID的映射关系

### 颜色配置 (ColorConfig)
- 基于CDDA终端风格的颜色方案
- 支持各种地形类型的颜色定义

### 生成配置
- **河流生成**: 密度参数配置
- **湖泊生成**: 噪声阈值、最小尺寸等
- **森林生成**: 双层噪声系统，支持方向性增长
- **沼泽生成**: 洪泛平原缓冲区配置
- **城市生成**: 城市间距、大小、建筑类型等

## 使用方法

1. 在Godot编辑器中打开项目
2. 运行主场景 `overmap_system.tscn`
3. 使用WASD或方向键控制玩家移动
4. 观察地图的动态生成效果

## 控制说明

- **WASD/方向键**: 移动玩家
- **玩家标记**: 红色方块，支持可配置的闪烁效果
- **地图跟随**: 玩家始终位于视图中心
- **调试信息**: 左下角显示实时坐标和区块信息

## 配置自定义

### 玩家闪烁控制
```gdscript
# 在PlayerConfig中修改
const BLINK_ENABLED: bool = true
const BLINK_INTERVAL: float = 0.1
```

### 森林方向性生成
```gdscript
# 在ForestConfig中调整
const INCREASE_NORTH: float = 0.04  # 北方向增长率
const INCREASE_EAST: float = 0.0    # 东方向增长率
const INCREASE_WEST: float = 0.02   # 西方向增长率
const INCREASE_SOUTH: float = 0.0   # 南方向增长率
```

### 城市生成参数
```gdscript
# 在CityConfig中配置
const CITY_SPACING: int = 3         # 城市间距
const CITY_SIZE: int = 12           # 基础城市大小
const BUILDING_CHANCE: int = 4      # 建筑生成概率
```

## 运行时配置

支持动态配置修改：
- `debug_mode`: 调试模式开关
- `forest_size_adjust`: 森林大小调整
- `forestosity`: 森林密度参数
- `custom_seed`: 自定义随机种子

## 技术实现

### 地图生成算法
1. **噪声生成**: 使用FastNoiseLite生成基础地形噪声
2. **地形叠加**: 按优先级叠加不同地形类型
3. **连续性保证**: 全局坐标系统确保区块间连续性
4. **性能优化**: 按需生成和智能缓存

### 区块管理
- **动态加载**: 基于玩家位置触发区块生成
- **内存管理**: 保留已生成区块，支持重复访问
- **边界检测**: 智能判断何时需要生成新区块

## 系统要求

- Godot 4.4+
- 支持Forward+渲染管线
- 建议分辨率: 1600x800或更高

## 开发状态

项目当前实现了完整的地图生成系统，支持多种地形类型的程序化生成，具备无限世界探索能力。配置系统提供了丰富的自定义选项，便于调整各种生成参数。